<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Market Insights - User Integration Example</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .auth-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .watchlist-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .feedback-section {
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #3367d6;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .user-info {
            background: #e8f0fe;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .watchlist-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
            margin: 5px 0;
        }
        .error {
            color: red;
            background: #ffebee;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            color: green;
            background: #e8f5e8;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AI Market Insights - User Integration Example</h1>
        
        <!-- Authentication Section -->
        <div class="auth-section">
            <h2>Authentication</h2>
            <div id="auth-status">
                <p>Not signed in</p>
                <button onclick="signIn()">Sign in with Google</button>
            </div>
            <div id="user-info" style="display: none;">
                <div class="user-info">
                    <p><strong>Signed in as:</strong> <span id="user-email"></span></p>
                    <p><strong>User ID:</strong> <span id="user-id"></span></p>
                </div>
                <button onclick="signOut()">Sign Out</button>
            </div>
        </div>

        <!-- Watchlist Section -->
        <div class="watchlist-section">
            <h2>My Watchlist</h2>
            <div id="watchlist-controls" style="display: none;">
                <input type="text" id="ticker-input" placeholder="Enter stock ticker (e.g., RELIANCE)">
                <button onclick="addStock()">Add to Watchlist</button>
            </div>
            <div id="watchlist-items"></div>
        </div>

        <!-- Feedback Section -->
        <div class="feedback-section">
            <h2>Submit Feedback</h2>
            <div id="feedback-form" style="display: none;">
                <select id="feedback-category">
                    <option value="">Select category...</option>
                    <option value="bug">Bug Report</option>
                    <option value="feature">Feature Request</option>
                    <option value="general">General Feedback</option>
                </select>
                <textarea id="feedback-message" rows="4" placeholder="Your feedback..."></textarea>
                <button onclick="submitFeedback()">Submit Feedback</button>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="status-messages"></div>
    </div>

    <script>
        // Firebase configuration (replace with your config)
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-project.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "your-app-id"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUser = null;
        let watchlistUnsubscribe = null;

        // Initialize authentication
        auth.onAuthStateChanged((user) => {
            if (user) {
                onUserLogin(user);
            } else {
                onUserLogout();
            }
        });

        function onUserLogin(user) {
            currentUser = user;
            
            // Update UI
            document.getElementById('auth-status').style.display = 'none';
            document.getElementById('user-info').style.display = 'block';
            document.getElementById('user-email').textContent = user.email;
            document.getElementById('user-id').textContent = user.uid;
            
            document.getElementById('watchlist-controls').style.display = 'block';
            document.getElementById('feedback-form').style.display = 'block';
            
            // Load watchlist
            loadWatchlist();
            
            showMessage('Successfully signed in!', 'success');
        }

        function onUserLogout() {
            currentUser = null;
            
            // Update UI
            document.getElementById('auth-status').style.display = 'block';
            document.getElementById('user-info').style.display = 'none';
            document.getElementById('watchlist-controls').style.display = 'none';
            document.getElementById('feedback-form').style.display = 'none';
            document.getElementById('watchlist-items').innerHTML = '';
            
            // Unsubscribe from watchlist updates
            if (watchlistUnsubscribe) {
                watchlistUnsubscribe();
                watchlistUnsubscribe = null;
            }
            
            showMessage('Signed out successfully', 'success');
        }

        function signIn() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).catch((error) => {
                showMessage('Sign-in failed: ' + error.message, 'error');
            });
        }

        function signOut() {
            auth.signOut().catch((error) => {
                showMessage('Sign-out failed: ' + error.message, 'error');
            });
        }

        function loadWatchlist() {
            if (!currentUser) return;
            
            const watchlistRef = db.collection('users').doc(currentUser.uid).collection('watchlist');
            
            watchlistUnsubscribe = watchlistRef.onSnapshot((snapshot) => {
                const watchlistItems = document.getElementById('watchlist-items');
                watchlistItems.innerHTML = '';
                
                if (snapshot.empty) {
                    watchlistItems.innerHTML = '<p>No stocks in watchlist</p>';
                    return;
                }
                
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'watchlist-item';
                    itemDiv.innerHTML = `
                        <span><strong>${data.ticker}</strong></span>
                        <button onclick="removeStock('${doc.id}')">Remove</button>
                    `;
                    watchlistItems.appendChild(itemDiv);
                });
            }, (error) => {
                showMessage('Error loading watchlist: ' + error.message, 'error');
            });
        }

        function addStock() {
            if (!currentUser) {
                showMessage('Please sign in first', 'error');
                return;
            }
            
            const ticker = document.getElementById('ticker-input').value.trim().toUpperCase();
            if (!ticker) {
                showMessage('Please enter a stock ticker', 'error');
                return;
            }
            
            const watchlistRef = db.collection('users').doc(currentUser.uid).collection('watchlist');
            
            // Check if already exists
            watchlistRef.where('ticker', '==', ticker).get().then((snapshot) => {
                if (!snapshot.empty) {
                    showMessage('Stock already in watchlist', 'error');
                    return;
                }
                
                // Add to watchlist
                watchlistRef.add({
                    ticker: ticker,
                    addedAt: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => {
                    document.getElementById('ticker-input').value = '';
                    showMessage('Stock added to watchlist', 'success');
                }).catch((error) => {
                    showMessage('Error adding stock: ' + error.message, 'error');
                });
            });
        }

        function removeStock(docId) {
            if (!currentUser) return;
            
            const docRef = db.collection('users').doc(currentUser.uid).collection('watchlist').doc(docId);
            docRef.delete().then(() => {
                showMessage('Stock removed from watchlist', 'success');
            }).catch((error) => {
                showMessage('Error removing stock: ' + error.message, 'error');
            });
        }

        function submitFeedback() {
            if (!currentUser) {
                showMessage('Please sign in first', 'error');
                return;
            }
            
            const category = document.getElementById('feedback-category').value;
            const message = document.getElementById('feedback-message').value.trim();
            
            if (!category || !message) {
                showMessage('Please fill in all fields', 'error');
                return;
            }
            
            const feedbackRef = db.collection('feedback');
            feedbackRef.add({
                userId: currentUser.uid,
                category: category,
                message: message,
                submittedAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                document.getElementById('feedback-category').value = '';
                document.getElementById('feedback-message').value = '';
                showMessage('Feedback submitted successfully', 'success');
            }).catch((error) => {
                showMessage('Error submitting feedback: ' + error.message, 'error');
            });
        }

        function showMessage(message, type) {
            const messagesDiv = document.getElementById('status-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.textContent = message;
            messagesDiv.appendChild(messageDiv);
            
            // Remove message after 5 seconds
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>
